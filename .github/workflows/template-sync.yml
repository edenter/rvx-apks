name: Sync with Template
on:
  schedule:
    - cron: "0 0 * * 1" # Runs weekly on Mondays
  workflow_dispatch:   # Allows manual triggering

jobs:
  sync:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          # Note: If your branch is "Protected", you must use a PAT instead of GITHUB_TOKEN
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Sync and Push Directly
        run: |
          git config user.name "github-actions[]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          git remote add template https://github.com/j-hc/revanced-magisk-module.git
          git fetch template
          
          # 1. Start merge without committing, favoring template changes for most files
          git merge template/main --allow-unrelated-histories -X theirs --no-commit
          
          # 2. Revert the specific file you want to ignore (keep your version)
          # Replace 'path/to/your/file' with the actual file path
          git checkout HEAD -- config.toml
          
          # 3. Finalize the merge commit
          git commit -m "chore: sync with template (kept local config) [skip ci]"
          
          git push origin HEAD:main
